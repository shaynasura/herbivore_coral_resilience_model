---
title: "Exp_Model_Bistability"
author: "Shayna Sura"
date: "12/2/2021 - December 2, 2021"
output: pdf_document
---

```{r setup, echo=FALSE}

library(deSolve)
library(ggplot2)
library(reshape2)
library(viridis)
library(gridExtra)

```


# Expanded Model Set up

```{r Phase 2 Model}


#These were the initial conditions for the basic model when I first ran that...
# H0<-0.9
# C0<-0.75
# M0<-0.1


G0<-0.45
R0<-0
B0<-0.45
C0<-0.75
T0<-0.05
M0<-0.05
S0 <- 1 - T0 - C0 - M0


P2_state_vars<-c(GG=G0, RR=R0, BB=B0, CC=C0, TT=T0, MM=M0, SS=S0)

#generate a series of times at which you want the ODE solver to output population sizes
P2_tseq<-seq(0,1000,by=0.1)

#Generate a vector of parameter values
P2_pars<-c(bc<-0.3,
           bt<-0.8,      #use the same value as bm from basic model
           bm<-0.8,      #use the same value as bm from basic model
           ic<-0.05,
           it<-0.025,    #need two of these, one for turf and one for macroalgae
           im<-0.025,    #need two of these, one for turf and one for macroalgae
           dc<-0.1,
           r<-1,
           # gt<-1,       #need two of these, one for turf and one for macroalgae
           # gm<-1,       #need two of these, one for turf and one for macroalgae
           gt<-2,       #need two of these, one for turf and one for macroalgae
           gm<-2,       #need two of these, one for turf and one for macroalgae
           etaT<-1,     #need two of these, one for turf and one for macroalgae
           etaM<-1,     #need two of these, one for turf and one for macroalgae
           alphaT<-0.5,
           alphaM<-0.5,
           sigma<-0.6,
           f<-0.1,
           gamma<-0)

P2_Model<-function(P2_tseq,P2_state_vars,P2_pars){
  GG <- P2_state_vars[1]
  RR <- P2_state_vars[2]
  BB <- P2_state_vars[3]
  CC <- P2_state_vars[4]
  TT <- P2_state_vars[5]
  MM <- P2_state_vars[6]
  SS <- 1 - CC - TT - MM
  
  bc <- P2_pars[1]
  bt <- P2_pars[2]
  bm <- P2_pars[3]
  ic <- P2_pars[4]
  it <- P2_pars[5]
  im <- P2_pars[6]
  dc <- P2_pars[7]
  r <- P2_pars[8]
  gt <- P2_pars[9]
  gm <- P2_pars[10]
  etaT <- P2_pars[11]
  etaM <- P2_pars[12]
  alphaT <- P2_pars[13]
  alphaM <- P2_pars[14]
  sigma <- P2_pars[15]
  f <- P2_pars[16]
  gamma <- P2_pars[17]
  
  dG_dt <-r*GG*(1 - ((GG+RR+BB) / ((1-sigma) + sigma*CC))) - f*GG
  dR_dt <-r*RR*(1 - ((GG+RR+BB) / ((1-sigma) + sigma*CC))) - f*RR
  dB_dt <-r*BB*(1 - ((GG+RR+BB) / ((1-sigma) + sigma*CC))) - f*BB
  dC_dt <- (ic + bc*CC)*SS*(1-(alphaT*TT+alphaM*MM)) - dc*CC
  dT_dt <- (it + bt*TT)*(SS) - (gamma*TT) - (((gt*GG*TT) / (gt*etaT*TT+1)) + ((gt*RR*TT)/(gt*etaT*TT+gm*etaM*MM+1)))
  dM_dt <- (im + bm*MM)*(SS) + (gamma*TT) - (((gm*BB*MM) / (gm*etaM*MM+1)) + ((gm*RR*MM)/(gt*etaT*TT+gm*etaM*MM+1)))


  return(list(c(dG <- dG_dt,
                dR <- dR_dt,
                dB <- dB_dt,
                dC <- dC_dt,
                dT <- dT_dt,
                dM <- dM_dt)))
}


```


## hh_pars   Parameter values actually used for expanded model

```{r}

#Generate a vector of parameter values
hh_pars<-c(bc<-0.3, bt<-0.8,bm<-0.5,      #expansion of current benthic cover
           ic<-0.05, it<-0.05, im<-0,     #import of propagules
           dc<-0.1,                       #coral mortality
           r<-1,                          #herbivore growth rate
           # gt<-1, gm<-0.5,                #algae mortality
           gt<-2, gm<-1,                #algae mortality
           etaT<-0, etaM<-1,              #algae handling time
           alphaT<-0.25, alphaM<-0.5,     #competitive effect on coral
           sigma<-0.6,                    #relationship between coral & herbivores
           f<-0.5,                        #fishing pressure
           gamma<-0.1)                    #transition from turf to macroalgae


```


## For loops over different initial coral cover for various levels of fishing pressure using the expanded model but with the parameters and initial conditions that allow it to collapse to the basic model

```{r}


##May 2, 2021 - setting a longer time frame to see if the system is actually reaching equilibrium or not..1000 instead of 100
#generate a series of times at which you want the ODE solver to output population sizes
P2_tseq<-seq(0,1000,by=0.1)

##October 25, 2021 - keeping the same length of time frame (1000), but only asking for output at intervals of 1, instead of 0.1 to see if that makes a difference.
# P2_tseq<-seq(0,1000,by=1)


f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

collapsed_1<-expand.grid(coral_initials,f_values)
colnames(collapsed_1)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(collapsed_1$Initial_Coral)){
    C0<-collapsed_1$Initial_Coral[i]
    B0<-0.45
    R0<-0
    G0<-0.45
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    P2_pars[16]<-collapsed_1$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, P2_pars)
    zz_output_new<-as.data.frame(zz_output)
    collapsed_1$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}


## Trying to figure out precisely which fishing pressure values the coral reef system exhibits bistability depending upon the initial coral cover conditions.
coll_C0_0<-subset(collapsed_1,subset = collapsed_1$Initial_Coral == 0)
coll_C0_0.85<-subset(collapsed_1,subset = collapsed_1$Initial_Coral == 0.85)

for(i in 1:nrow(coll_C0_0)){
  coll_C0_0$bistability[i]<-format(round(coll_C0_0[i,3], 7), nsmall = 7) != 
                     format(round(coll_C0_0.85[i,3], 7), nsmall = 7)
}


## Find the fishing pressure values where the system can exhibit bistability
min(coll_C0_0$Fishing_Pressure[which(coll_C0_0$bistability==TRUE)])
max(coll_C0_0$Fishing_Pressure[which(coll_C0_0$bistability==TRUE)])
coll_C0_0$Fishing_Pressure[which(coll_C0_0$bistability==TRUE)]
## bistability between 0.33 - 0.51

```



## For loops over different initial coral cover for various levels of fishing pressure using the expanded model but with the more realistic parameters (hh_pars). The initial conditions are the same though.

```{r}
f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

expanded_1<-expand.grid(coral_initials,f_values)
colnames(expanded_1)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(expanded_1$Initial_Coral)){
    C0<-expanded_1$Initial_Coral[i]
    B0<-0.3
    R0<-0.3
    G0<-0.3
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-expanded_1$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    expanded_1$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}


## Trying to figure out precisely which fishing pressure values the coral reef system exhibits bistability depending upon the initial coral cover conditions.
exp_C0_0<-subset(expanded_1,subset = expanded_1$Initial_Coral == 0)
exp_C0_0.85<-subset(expanded_1,subset = expanded_1$Initial_Coral == 0.85)

for(i in 1:nrow(exp_C0_0)){
  exp_C0_0$bistability[i]<-format(round(exp_C0_0[i,3], 7), nsmall = 7) != 
                     format(round(exp_C0_0.85[i,3], 7), nsmall = 7)
}


## Find the fishing pressure values where the system can exhibit bistability
min(exp_C0_0$Fishing_Pressure[which(exp_C0_0$bistability==TRUE)])
max(exp_C0_0$Fishing_Pressure[which(exp_C0_0$bistability==TRUE)])
exp_C0_0$Fishing_Pressure[which(exp_C0_0$bistability==TRUE)]
## bistability between 0.42 - 0.58


```



## For loops over different initial coral covers for various levels of fishing pressure under either high browsers, high generalists, or high grazers scenarios

```{r}

## High Browsers

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_1<-expand.grid(coral_initials,f_values)
colnames(high_browsers_1)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_1$Initial_Coral)){
    C0<-high_browsers_1$Initial_Coral[i]
    B0<-0.6
    R0<-0.15
    G0<-0.15
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_1$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_1$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}


## High Grazers

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_grazers_1<-expand.grid(coral_initials,f_values)
colnames(high_grazers_1)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_grazers_1$Initial_Coral)){
    C0<-high_grazers_1$Initial_Coral[i]
    B0<-0.15
    R0<-0.15
    G0<-0.6
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_grazers_1$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_grazers_1$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}



## High Generalists

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_generalists_1<-expand.grid(coral_initials,f_values)
colnames(high_generalists_1)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_generalists_1$Initial_Coral)){
    C0<-high_generalists_1$Initial_Coral[i]
    B0<-0.15
    R0<-0.6
    G0<-0.15
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_generalists_1$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_generalists_1$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}


```


## Heat map of output

```{r Fig. 5A Main Text}

## Combine output of all 5 so I can plot them all easily with ggplot

# Row bind the various data frames in order to plot by them
collapsed_1$Id="Collapsed"
# expanded_1$Id="Expanded"
expanded_1$Id="Herbivore groups even"
high_browsers_1$Id="Browser-dominated"
high_grazers_1$Id="Grazer-dominated"
high_generalists_1$Id="Generalist-dominated"
bistability_all=rbind(collapsed_1, expanded_1,high_generalists_1, high_browsers_1, high_grazers_1)

# bistability_all$Id <- factor(bistability_all$Id, levels=c("Collapsed","Expanded","Generalist-dominated","Browser-dominated","Grazer-dominated"))
bistability_all$Id <- factor(bistability_all$Id, levels=c("Collapsed","Herbivore groups even","Generalist-dominated","Browser-dominated","Grazer-dominated"))


## Code for new version of plot for manuscript figure!
## March 3, 2020: Re-ordering the panels
## pdf("Paper_Fig_5_panel_A_2.pdf",width=3.75,height=10)
## April 8, 2020: Renaming panels
# pdf("Paper_Fig_5_panel_A_3.pdf",width=3.75,height=10)
# pdf("Paper_Fig_5_panel_A_3_May2021.pdf",width=3.75,height=10)



# pdf("Fig_5A_NEW.pdf",width=3.75,height=10)

# pdf("Fig_5A_NEW.pdf",width=3.5,height=11)
# pdf("Fig_5A_NEW_v2.pdf",width=3.5,height=11) #this version has S0 = 0.05, and coral initials ranging all the way up to 1

pdf("Fig_5A_NEW_v3.pdf",width=3.5,height=11) #this version has S0 = 0.15, and coral initials only going as high as 0.85

# October 25, 2021 - this was just testing whether using a different P2_tseq<-seq(0,1000,by=1) made a difference in the fuzziness of the output or not. Asking for output in intervals of 1 or 0.1, does not affect the final output of the model run.
# pdf("Fig_5A_NEW_v2_test.pdf",width=3.5,height=11)

#quartz()
ggplot(bistability_all, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  xlim(0,1) + 
  # ylim(0,1) + 
  ylim(0,0.85) + 
  ylab("Initial Coral Cover") +
  xlab("Fishing Pressure") +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  facet_wrap(~Id,nrow = 5) +
  theme(strip.text.x = element_text(size = 11))

dev.off()



```


### Run the Browser-dominated scenario for 10,000 time steps to see if the fuzziness resolves any further...

```{r}

P2_tseq<-seq(0,10000,by=0.1)

## High Browsers

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_1_10x<-expand.grid(coral_initials,f_values)
colnames(high_browsers_1_10x)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_1_10x$Initial_Coral)){
    C0<-high_browsers_1_10x$Initial_Coral[i]
    B0<-0.6
    R0<-0.15
    G0<-0.15
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_1_10x$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_1_10x$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}


## Plot for just 1 output

pdf("Fig_5A_Browsers_10000.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_1_10x, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  xlim(0,1) + 
  # ylim(0,1) + 
  ylim(0,0.85) + 
  ylab("Initial Coral Cover") +
  xlab("Fishing Pressure") +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8))
#   ggtitle(paste("Fishing Pressure = ",f_values[i])) + 
#  facet_wrap(~Id,nrow = 3)

dev.off()


```




```{r Figures for DISL Seminar March 2022}

## Plot for just "even" output for ESA presentation
pdf("DISL_Figure_1.pdf",width=4,height=3)

#quartz()
ggplot(expanded_1, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=12,base_family = "Times") + 
  theme(axis.title=element_text(size=14,face="bold")) +
  xlim(0,1) + 
  ylim(0,0.85) + 
  ylab("Initial Coral Cover") +
  xlab("Fishing Pressure") +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) 

dev.off()


## Plotting them horizontally instead of vertically for ICRS Presentation

# give them IDs
expanded_1$Id="Herbivore groups even"
high_browsers_1$Id="Browser-dominated"
high_grazers_1$Id="Grazer-dominated"
high_generalists_1$Id="Generalist-dominated"

#subset the data to exclude the "collapsed" output
bistability_4=rbind(expanded_1,high_generalists_1, high_browsers_1, high_grazers_1)
bistability_4$Id <- factor(bistability_4$Id, levels=c("Herbivore groups even","Generalist-dominated","Browser-dominated","Grazer-dominated"))


# pdf("ICRS_Figure_4.pdf",width=11,height=3.5)
# pdf("ICRS_Figure_4_v2.pdf",width=10,height=3)
# pdf("ICRS_Figure_4_v3.pdf",width=9.7,height=2.5)
# pdf("ICRS_Figure_4_v4.pdf",width=9,height=2.5)
pdf("DISL_Figure_2_v1.pdf",width=9,height=2.5)

#quartz()
ggplot(bistability_4, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  # xlim(0,1) + 
  # ylim(0,1) + 
  # ylab("Initial Coral Cover") +
  # xlab("Fishing Pressure") +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85)) +
  facet_wrap(~Id,ncol = 4) +
  theme(strip.text.x = element_text(size = 11))

dev.off()


```



## UPDATED THE BROWSERS TO HAVE S0 = 0.15 and y-axis max to 0.85
### March 14, 2022

## Changing the browser-dominated scenario conditions to see if we can make the bistability disappear completely
### May 26, 2021

```{r}

P2_tseq<-seq(0,1000,by=0.1)

## High Browsers - 0.7

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_2<-expand.grid(coral_initials,f_values)
colnames(high_browsers_2)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_2$Initial_Coral)){
    C0<-high_browsers_2$Initial_Coral[i]
    B0<-0.7
    R0<-0.10
    G0<-0.10
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_2$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_2$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}




## High Browsers - 0.65

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_3<-expand.grid(coral_initials,f_values)
colnames(high_browsers_3)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_3$Initial_Coral)){
    C0<-high_browsers_3$Initial_Coral[i]
    B0<-0.65
    R0<-0.125
    G0<-0.125
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_3$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_3$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}




## High Browsers - 0.66

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_4<-expand.grid(coral_initials,f_values)
colnames(high_browsers_4)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_4$Initial_Coral)){
    C0<-high_browsers_4$Initial_Coral[i]
    B0<-0.66
    R0<-0.12
    G0<-0.12
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_4$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_4$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}





## High Browsers - 0.67

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_5<-expand.grid(coral_initials,f_values)
colnames(high_browsers_5)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_5$Initial_Coral)){
    C0<-high_browsers_5$Initial_Coral[i]
    B0<-0.67
    R0<-0.115
    G0<-0.115
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_5$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_5$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}




## High Browsers - 0.68

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_6<-expand.grid(coral_initials,f_values)
colnames(high_browsers_6)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_6$Initial_Coral)){
    C0<-high_browsers_6$Initial_Coral[i]
    B0<-0.68
    R0<-0.11
    G0<-0.11
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_6$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_6$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}



## High Browsers - 0.69

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_7<-expand.grid(coral_initials,f_values)
colnames(high_browsers_7)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_7$Initial_Coral)){
    C0<-high_browsers_7$Initial_Coral[i]
    B0<-0.69
    R0<-0.105
    G0<-0.105
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_7$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_7$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}



## High Browsers - 0.75

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_8<-expand.grid(coral_initials,f_values)
colnames(high_browsers_8)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_8$Initial_Coral)){
    C0<-high_browsers_8$Initial_Coral[i]
    B0<-0.75
    R0<-0.075
    G0<-0.075
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_8$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_8$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}


```


```{r}

## Figure with initial browsers at 0.7
# pdf("Browsers_Bistability_07.pdf",width=4,height=3)
pdf("Browsers_Bistability_07_v2.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_2, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85))

dev.off()


## Figure with initial browsers at 0.65
# pdf("Browsers_Bistability_065.pdf",width=4,height=3)
pdf("Browsers_Bistability_065_v2.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_3, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85))

dev.off()



## Figure with initial browsers at 0.66
# pdf("Browsers_Bistability_066.pdf",width=4,height=3)
pdf("Browsers_Bistability_066_v2.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_4, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85))

dev.off()


## Figure with initial browsers at 0.67
# pdf("Browsers_Bistability_067.pdf",width=4,height=3)
pdf("Browsers_Bistability_067_v2.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_5, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85))

dev.off()



## Figure with initial browsers at 0.68
# pdf("Browsers_Bistability_068.pdf",width=4,height=3)
pdf("Browsers_Bistability_068_v2.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_6, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85))

dev.off()



## Figure with initial browsers at 0.69
# pdf("Browsers_Bistability_069.pdf",width=4,height=3)
pdf("Browsers_Bistability_069_v2.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_7, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85))

dev.off()


## Figure with initial browsers at 0.75
# pdf("Browsers_Bistability_075.pdf",width=4,height=3)
pdf("Browsers_Bistability_075_v2.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_8, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85))

dev.off()

```

## Plotting all the browser scenarios together!

```{r}


high_browsers_3$Id<-"B0 = 0.65"
high_browsers_4$Id<-"B0 = 0.66"
high_browsers_5$Id<-"B0 = 0.67"
high_browsers_6$Id<-"B0 = 0.68"
high_browsers_7$Id<-"B0 = 0.69"
high_browsers_2$Id<-"B0 = 0.70"
high_browsers_8$Id<-"B0 = 0.75"

  
browser_bistability=rbind(high_browsers_3, high_browsers_4, high_browsers_5, high_browsers_6, high_browsers_7, high_browsers_2, high_browsers_8)
browser_bistability$Id <- factor(browser_bistability$Id, levels=c("B0 = 0.65","B0 = 0.66","B0 = 0.67","B0 = 0.68", "B0 = 0.69", "B0 = 0.70","B0 = 0.75"))


# pdf("Browsers_Bistability_All.pdf",width=5,height=9)
pdf("Browsers_Bistability_All_v2.pdf",width=5,height=9)

#quartz()
ggplot(browser_bistability, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.2,0.4,0.6,0.8),
                         labels = c(0,0.2,0.4,0.6,0.8), limits = c(0,0.85)) +
  facet_wrap(~Id,nrow = 4, ncol = 2) +
  theme(strip.text.x = element_text(size = 11))

dev.off()


```














## DID NOT UPDATE THIS SECTION TO HAVE S0 = 0.15, or initial corals and y-axis to only 0.85

```{r}

## Plot for just "collapsed" output for ESA presentation
pdf("ESA_Figure_2.pdf",width=4,height=3)

#quartz()
ggplot(collapsed_1, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=12,base_family = "Times") + 
  theme(axis.title=element_text(size=14,face="bold")) +
  xlim(0,1) + 
  ylim(0,1) + 
  ylab("Initial Coral Cover") +
  xlab("Fishing Pressure") +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) 

dev.off()



## Plot for just 1 output

quartz()
ggplot(high_browsers_1, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral), color = "white") +
  theme_classic(base_size=18) + 
  xlim(0,1) + 
  ylim(0,1) + 
  ylab("Initial Coral Cover") +
  xlab("Fishing Pressure") +
  labs(fill = "Final Coral\nCover") +
#   ggtitle(paste("Fishing Pressure = ",f_values[i])) + 
  scale_fill_viridis(option = "viridis",limits=c(0,0.8))
#  facet_wrap(~Id,nrow = 3)


## Plotting them horizontally instead of vertically for ICRS Presentation

#subset the data to exclude the "collapsed" output
bistability_4=rbind(expanded_1,high_generalists_1, high_browsers_1, high_grazers_1)
bistability_4$Id <- factor(bistability_4$Id, levels=c("Herbivore groups even","Generalist-dominated","Browser-dominated","Grazer-dominated"))


# pdf("ICRS_Figure_4.pdf",width=11,height=3.5)
# pdf("ICRS_Figure_4_v2.pdf",width=10,height=3)
# pdf("ICRS_Figure_4_v3.pdf",width=9.7,height=2.5)
pdf("ICRS_Figure_4_v4.pdf",width=9,height=2.5)

#quartz()
ggplot(bistability_4, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  # xlim(0,1) + 
  # ylim(0,1) + 
  # ylab("Initial Coral Cover") +
  # xlab("Fishing Pressure") +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1)) +
  facet_wrap(~Id,ncol = 4) +
  theme(strip.text.x = element_text(size = 11))

dev.off()



```


## Changing the browser-dominated scenario conditions to see if we can make the bistability disappear completely
### May 26, 2021

```{r}

P2_tseq<-seq(0,1000,by=0.1)

## High Browsers - 0.7

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_2<-expand.grid(coral_initials,f_values)
colnames(high_browsers_2)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_2$Initial_Coral)){
    C0<-high_browsers_2$Initial_Coral[i]
    B0<-0.7
    R0<-0.10
    G0<-0.10
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_2$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_2$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}




## High Browsers - 0.65

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_3<-expand.grid(coral_initials,f_values)
colnames(high_browsers_3)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_3$Initial_Coral)){
    C0<-high_browsers_3$Initial_Coral[i]
    B0<-0.65
    R0<-0.125
    G0<-0.125
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_3$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_3$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}




## High Browsers - 0.66

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_4<-expand.grid(coral_initials,f_values)
colnames(high_browsers_4)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_4$Initial_Coral)){
    C0<-high_browsers_4$Initial_Coral[i]
    B0<-0.66
    R0<-0.12
    G0<-0.12
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_4$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_4$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}





## High Browsers - 0.67

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_5<-expand.grid(coral_initials,f_values)
colnames(high_browsers_5)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_5$Initial_Coral)){
    C0<-high_browsers_5$Initial_Coral[i]
    B0<-0.67
    R0<-0.115
    G0<-0.115
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_5$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_5$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}




## High Browsers - 0.68

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_6<-expand.grid(coral_initials,f_values)
colnames(high_browsers_6)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_6$Initial_Coral)){
    C0<-high_browsers_6$Initial_Coral[i]
    B0<-0.68
    R0<-0.11
    G0<-0.11
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_6$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_6$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}



## High Browsers - 0.69

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_7<-expand.grid(coral_initials,f_values)
colnames(high_browsers_7)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_7$Initial_Coral)){
    C0<-high_browsers_7$Initial_Coral[i]
    B0<-0.69
    R0<-0.105
    G0<-0.105
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_7$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_7$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}



## High Browsers - 0.75

f_values<-seq(0,1,by=0.01)
# coral_initials<-seq(0,1,0.01)
coral_initials<-seq(0,0.85,0.01)

high_browsers_8<-expand.grid(coral_initials,f_values)
colnames(high_browsers_8)<-c("Initial_Coral","Fishing_Pressure")


for(i in 1:length(high_browsers_8$Initial_Coral)){
    C0<-high_browsers_8$Initial_Coral[i]
    B0<-0.75
    R0<-0.075
    G0<-0.075
#    C0<-0.75
    S0<-0.15
    M0<-(1-C0-S0)/2
    T0<-(1-C0-S0)/2
    hh_pars[16]<-high_browsers_8$Fishing_Pressure[i]   #set the fishing pressure
    zz_output<-lsoda(c(Grazers =G0, Generalists =R0, Browsers =B0,
                   Coral = C0,Turf = T0,Macroalgae=M0),
                 P2_tseq, P2_Model, hh_pars)
    zz_output_new<-as.data.frame(zz_output)
    high_browsers_8$Final_Coral[i]<-tail(zz_output_new$Coral,1)
}


```


```{r}

## Figure with initial browsers at 0.7
pdf("Browsers_Bistability_07.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_2, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1))

dev.off()


## Figure with initial browsers at 0.65
pdf("Browsers_Bistability_065.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_3, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1))

dev.off()



## Figure with initial browsers at 0.66
pdf("Browsers_Bistability_066.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_4, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1))

dev.off()


## Figure with initial browsers at 0.67
pdf("Browsers_Bistability_067.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_5, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1))

dev.off()



## Figure with initial browsers at 0.68
pdf("Browsers_Bistability_068.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_6, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1))

dev.off()



## Figure with initial browsers at 0.69
pdf("Browsers_Bistability_069.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_7, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1))

dev.off()


## Figure with initial browsers at 0.75
pdf("Browsers_Bistability_075.pdf",width=4,height=3)

#quartz()
ggplot(high_browsers_8, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1))

dev.off()

```

## Plotting all the browser scenarios together!

```{r}


high_browsers_3$Id<-"B0 = 0.65"
high_browsers_4$Id<-"B0 = 0.66"
high_browsers_5$Id<-"B0 = 0.67"
high_browsers_6$Id<-"B0 = 0.68"
high_browsers_7$Id<-"B0 = 0.69"
high_browsers_2$Id<-"B0 = 0.70"
high_browsers_8$Id<-"B0 = 0.75"

  
browser_bistability=rbind(high_browsers_3, high_browsers_4, high_browsers_5, high_browsers_6, high_browsers_7, high_browsers_2, high_browsers_8)
browser_bistability$Id <- factor(browser_bistability$Id, levels=c("B0 = 0.65","B0 = 0.66","B0 = 0.67","B0 = 0.68", "B0 = 0.69", "B0 = 0.70","B0 = 0.75"))


# pdf("Browsers_Bistability_All.pdf",width=5,height=9)
pdf("Browsers_Bistability_All_v2.pdf",width=5,height=9)

#quartz()
ggplot(browser_bistability, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1),limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1), limits = c(0,1)) +
  facet_wrap(~Id,nrow = 4, ncol = 2) +
  theme(strip.text.x = element_text(size = 11))

dev.off()



## Making the above figure in a different layout and not including the B0=0.75 scenario

browser_bistability_2=rbind(high_browsers_3, high_browsers_4, high_browsers_5, high_browsers_6, high_browsers_7, high_browsers_2)
browser_bistability_2$Id <- factor(browser_bistability_2$Id, levels=c("B0 = 0.65","B0 = 0.66","B0 = 0.67","B0 = 0.68", "B0 = 0.69", "B0 = 0.70"))

pdf("Browsers_Bistability_All_v4.pdf",width=6.5,height=4)

#quartz()
ggplot(browser_bistability_2, aes(Fishing_Pressure, Initial_Coral)) +
  geom_tile(aes(fill = Final_Coral)) +
  theme_classic(base_size=14,base_family = "Times") + 
  theme(axis.title=element_text(size=16,face="bold")) +
  labs(fill = "Final\nCoral\nCover") +
  scale_fill_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_colour_viridis(option = "viridis",limits=c(0,0.8)) +
  scale_x_continuous("Fishing Pressure",expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
                         labels = c(0,0.25,0.5,0.75,1.0),limits = c(0,1)) +
  # scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.25,0.5,0.75,1),
  #                        labels = c(0,0.25,0.5,0.75,1), limits = c(0,1)) +
  scale_y_continuous("Initial Coral Cover", expand = c(0, 0), breaks = c(0,0.3,0.6,0.9),
                         labels = c(0,0.3,0.6,0.9), limits = c(0,0.9)) +
  facet_wrap(~Id,nrow = 2, ncol = 3) +
  theme(strip.text.x = element_text(size = 11))

dev.off()


```



